Sub Sample()

Dim WbInput, wbMonthly, wbYearly As Workbook
Dim ws As Worksheet
Application.DisplayAlerts = False
    

''''''''''Open Master/Yearly Report''''''''''''
    Workbooks.Open (".xlsx")
    Set wbYearly = ActiveWorkbook
    wbYearly.Sheets("sheet1").Activate
    LstRw_Yearly = Range("A" & Rows.Count).End(xlUp).Row
    Range("A1").Select
   
   
   
   
''''' Open Monthly Report File of the Month '''''
    Workbooks.Open (".xlsx")
    Set wbMonthly = ActiveWorkbook
    ActiveSheet.AutoFilterMode = False
    Range("A1").Select
    wbMonthly.Sheets("").Activate
        
        
''''''Open Input DB Extract Files''''''
    Workbooks.Open (".xlsx")
    Set WbInput = ActiveWorkbook
    WbInput.Sheets("Sheet1").Select
    LstRw_Source = Range("A" & Rows.Count).End(xlUp).Row
    WbInput.Sheets("Sheet1").Activate
    ActiveSheet.AutoFilterMode = False
    Range("1:1").Select
    Selection.AutoFilter Field:=6, Criteria1:="c"
    Range("A1:A" & LstRw_Source).Select
    VisibleTotal = ActiveSheet.Range("A2:A" & LstRw_Source).SpecialCells(xlCellTypeVisible).Count
        
        
        
    
    ''''''Update the Total success count''''
    wbMonthly.Sheets("").Activate
    LstRw_Count = Range("A" & Rows.Count).End(xlUp).Row
    Set rng = Range("A:A").Find(what:="Total", After:=Range("A1"), LookIn:=xlFormulas, lookat:=xlWhole)
        rng.Activate
        ActiveCell.EntireRow.Insert
        'newDate = Format(DateAdd("M", -1, Now), MMMMM)
        TDate = Date
        ActiveCell.Offset(-1, 0).Select
        Selection.Value = TDate
        ActiveCell.Offset(0, 1).Select
        Selection.Value = VisibleTotal
'        ActiveCell.Offset(-1, 1).Value = VisibleTotal

     wbMonthly.Sheets("").Activate
     ActiveSheet.AutoFilterMode = False
     LstRw_Success = Range("A" & Rows.Count).End(xlUp).Row
    
    '''''Update the success data''''
    WbInput.Sheets("Sheet1").Activate
    ActiveSheet.Range("A2:Z" & LstRw_Source).SpecialCells(xlCellTypeVisible).Select
    Selection.Copy Destination:=wbMonthly.Sheets("Successful Emails").Range("A" & LstRw_Success + 1)
    Range("A1").Select
     wbMonthly.Sheets("Invalid Emails").Activate
     ActiveSheet.AutoFilterMode = False
     LstRw_Fail = Range("A" & Rows.Count).End(xlUp).Row
    
    ''''''Update the Invalid Data in Montly and Yearly File''''
    WbInput.Sheets("Sheet1").Activate
    ActiveSheet.AutoFilterMode = False
    Range("1:1").Select
    Selection.AutoFilter Field:=6, Criteria1:="b"
    ActiveSheet.Range("A2:Z" & LstRw_Source).SpecialCells(xlCellTypeVisible).Select
    Selection.Copy Destination:=wbMonthly.Sheets("Invalid Emails").Range("A" & LstRw_Fail + 1)
    Selection.Copy Destination:=wbYearly.Sheets("sheet1").Range("A" & LstRw_Yearly + 1)
    Range("A1").Select

    
    '''''''''''Date range filter in yearly/Master report file''''''''''
        wbYearly.Sheets("sheet1").Activate
        LstRw_Yearly = Range("A" & Rows.Count).End(xlUp).Row
        newDate = Format(DateAdd("M", -2, Date), MMMMM)
        ActiveSheet.AutoFilterMode = False
        Range("1:1").Select
        Selection.AutoFilter Field:=5, Criteria1:=">" & newDate
        ActiveSheet.Range("A1:Z" & LstRw_Yearly).SpecialCells(xlCellTypeVisible).Copy
        Sheets.Add
        Range("A1").PasteSpecial
        Cells.EntireColumn.AutoFit
        ActiveSheet.Name = "6MonthsTab"
        Range("A1").Select
        
        
     
       
        Range("A1").Select
        
    '''''Backup of 6Months Data sheet into new workbook'''''''''''
        wbYearly.Sheets("6MonthsTab").Activate
        ActiveSheet.AutoFilterMode = False
        Cells.Copy
        Workbooks.Add
        ActiveWorkbook.Sheets(1).Range("A1").Select
        Selection.PasteSpecial
        ActiveWorkbook.SaveAs (".xlsx")
        ActiveWorkbook.Save
        ActiveWorkbook.Close
        
        wbYearly.Sheets("Pivot").Activate
        wbYearly.Sheets("Pivot").Delete
        wbYearly.Sheets("6MonthsTab").Delete
        ActiveSheet.AutoFilterMode = False
        Range("A1").Select
        
     '''Save The Workbook'''
        
        wbYearly.Close
        
        wbMonthly.Sheets("").Activate
        Range("A1").Select
       ' wbMonthly.Save
        wbMonthly.Close
        
        WbInput.Activate
        Range("A1").Select
        'WbInput.Save
        WbInput.Close
    
    
End Sub
